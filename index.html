<!doctype html>
<html lang="th">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>WE WIN Registration</title>
<link rel="stylesheet" href="css/style.css">
</head>
<body>
  <div class="container">
    <h1>WE WIN Registration</h1>
    <form id="regForm" enctype="multipart/form-data">
      <input type="text" name="hp_field" style="display:none" tabindex="-1" autocomplete="off">

      <label>ชื่อ-นามสกุล *</label>
      <input type="text" name="fullName" required>

      <label>Line name *</label>
      <input type="text" name="lineName" required>

      <label>จำนวนเงินทุน (บาท) *</label>
      <input type="number" name="capital" required min="0" step="1000">

      <label>กลุ่มหุ้นที่สนใจ</label>
      <div>
        <input type="checkbox" name="sectors" value="พลังงาน"> พลังงาน
        <input type="checkbox" name="sectors" value="ธนาคาร/การเงิน"> ธนาคาร/การเงิน
        <input type="checkbox" name="sectors" value="เทคโนโลยี"> เทคโนโลยี
        <input type="checkbox" name="sectors" value="อสังหา"> อสังหา
        <input type="checkbox" name="sectors" value="สุขภาพ"> สุขภาพ
        <input type="checkbox" name="sectors" value="ท่องเที่ยว/โรงแรม"> ท่องเที่ยว/โรงแรม
      </div>

      <label>สไตล์การเทรด *</label>
      <select name="tradingStyle" required>
        <option value="">— เลือก —</option>
        <option>Day Trade</option>
        <option>Swing Trade</option>
        <option>Position</option>
        <option>DCA/Long-term</option>
        <option>Algo/Quant</option>
      </select>

      <label>รูป QR code (ไม่บังคับ)</label>
      <input type="file" name="photo" id="photo" accept="image/*">
      <div id="photoPreviewContainer"></div>

      <button type="submit">ส่งข้อมูล</button>
      <button type="reset">ล้างข้อมูล</button>

      <div id="status"></div>
    </form>
  </div>

<script>
const form = document.getElementById('regForm');
const statusBox = document.getElementById('status');
const photoInput = document.getElementById('photo');
const previewContainer = document.getElementById('photoPreviewContainer');

photoInput.addEventListener('change', () => {
  previewContainer.innerHTML = '';
  const file = photoInput.files[0];
  if (file) {
    const img = document.createElement('img');
    img.style.maxWidth = '200px';
    img.src = URL.createObjectURL(file);
    previewContainer.appendChild(img);
  }
});

form.addEventListener('submit', async (e) => {
  e.preventDefault();
  statusBox.innerHTML = '';
  statusBox.className = '';

  const fd = new FormData(form);

  // รวม checkbox sectors
  const sectors = [];
  form.querySelectorAll('input[name="sectors"]:checked').forEach(el => sectors.push(el.value));
  fd.delete('sectors');
  fd.append('sectors', sectors.join(', '));

  statusBox.textContent = '⏳ กำลังส่งข้อมูล...';

  try {
    const resp = await fetch('https://wewin-backend.onrender.com/api/register', {
      method: 'POST',
      body: fd
    });

    const data = await resp.json().catch(() => ({}));

    if (data.ok) {
      statusBox.className = 'success';
      statusBox.textContent = data.message || '✅ ส่งสำเร็จ';
      form.reset();
      previewContainer.innerHTML = '';
    } else {
      statusBox.className = 'error';
      statusBox.textContent = data.error || '❌ เกิดข้อผิดพลาด';
    }
  } catch (err) {
    console.error(err);
    statusBox.className = 'error';
    statusBox.textContent = '❌ ไม่สามารถเชื่อมต่อ Server ได้';
  }
});
</script>

<style>
#status.success { color: green; font-weight: bold; margin-top:10px; }
#status.error { color: red; font-weight: bold; margin-top:10px; }
#photoPreviewContainer img { border: 1px solid #ccc; padding: 2px; border-radius: 4px; margin-top: 5px; }
</style>
</body>
</html>
